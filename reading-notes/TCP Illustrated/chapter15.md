# 第十五章

##　15.3 延时确认

累计确认可以允许TCP延迟一段时间发送ACK,以便将ACK和相同方向上需要传输的数据结合发送，TCP实现ACK延迟的时延应该小于500ms，实践中时延最大取200ms

## 15.4 Nagle算法

Nagle算法要求，当一个TCP连接中有再传数据，小的报文段就不能发送，直到所有的在传数据都收到ACK，并且TCP需要手机这些小数据，将其整合到一个报文段中发送。该算法的精妙之处在于它实现了自时钟控制：ACK返回越快，数据传输也越快，在相对高延迟的网络中，更需要减少微型数据报的数目,也就是说RTT控制着发包速率。

## 15.4.1 延时ACK与Nagle算法j结合

延时ACK与Nagle结合导致某种程度的死锁，在延时ACK计时器超时后这种死锁接触，但期间整个传输连接处于空闲状态，使性能变差。

## 15.5 流量控制与窗口管理

### 15.5.3 糊涂窗口综合征

TCP两端都可能导致SWS出现，接收端的通告窗口较小，或者发送端发送的窗口较小，为避免SWS需遵循以下两个原则：

1. 对于接收端来说，不应该通告小的窗口，具体来说，只有在通告窗口至少为总接收缓存的一半或者一个MSS时才发送窗口更新，并且只有当窗口至少为一个MSS或者总接收缓存的四分之一的时候才响应窗口探测，一个例外是为了避免窗口缩小，通告小的窗口，避免算法在发送端实施
2. 对于发送端来说，只有至少满足下面三个条件时，才传输报文段   
    - a. 全长（MSS）报文段可以发送
    - b. 数据段长度>=接收端通告过的最大窗口值的一半的，可以发送
    - c. (i)某一ACK不是目前期盼的，(ii)该连接禁用Nagle算法